{% extends '../shared/_blank.html' %} 
{% block title %} Kirish {% endblock %} 
{% block content %} 
{% load static %} 
{% load i18n %} 
{% load socialaccount %}
<div class="login-wrapper">
  <div class="login-container">
    <div class="mascot-wrapper">
      <img src="https://cdn-icons-png.flaticon.com/512/4712/4712139.png" alt="Owl Mascot" class="mascot-img" />
    </div>
    <div class="login-card">
      <div class="login-header">
        <h1>Kirish</h1>
        <p>Deeplandda sayohatingizni davom ettiring</p>
      </div>
      <form method="post" action="{% url 'login' %}">
        {% csrf_token %}
        
        {% if form.non_field_errors %}
          <div style="color: var(--theme-red); background: var(--theme-red-light); padding: 10px; border-radius: 8px; margin-bottom: 15px; font-weight: 700; font-size: 0.9rem; text-align: center;">
            {% for error in form.non_field_errors %}
              {{ error }}
            {% endfor %}
          </div>
        {% endif %}

        <div class="form-group">
          <div class="input-wrapper">
            {{ form.username }}
            <i class="fa-regular fa-envelope input-icon"></i>
          </div>
          {% if form.username.errors %}
            <div style="color: var(--theme-red); font-size: 0.8rem; margin-top: 5px; font-weight: 700;">{{ form.username.errors.0 }}</div>
          {% endif %}
        </div>
        
        <div class="form-group" style="margin-bottom: 10px">
          <div class="input-wrapper">
            {{ form.password }}
            <i class="fa-solid fa-lock input-icon"></i>
          </div>
          {% if form.password.errors %}
            <div style="color: var(--theme-red); font-size: 0.8rem; margin-top: 5px; font-weight: 700;">{{ form.password.errors.0 }}</div>
          {% endif %}
        </div>
        
        <a href="#" class="forgot-pass">Parolni unutdingizmi?</a>
        
        <!-- The vital widget -->
        <div class="cf-turnstile" data-sitekey="{{ turnstile_site_key }}" data-theme="light" style="margin-bottom: 15px;"></div>
        
        {% if form.cf_turnstile.errors %}
          <div style="color: var(--theme-red); font-size: 0.85rem; margin-top: -10px; margin-bottom: 15px; font-weight: 700;">
            Kaptcha xatoligi: Iltimos, qaytadan urinib ko'ring ({{ form.cf_turnstile.errors.0 }})
          </div>
        {% endif %}
        
        <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
        
        <button type="submit" class="btn-login btn-transform">Kirish</button>
      </form>
      
      <!-- Hidden debug panel if there are hidden errors -->
      {% if form.errors and not form.non_field_errors and not form.username.errors and not form.password.errors and not form.cf_turnstile.errors %}
      <div style="color: var(--theme-red); font-size: 0.8rem; margin-top: 10px;">
        Noma'lum xatolik: {{ form.errors }}
      </div>
      {% endif %}

      <div class="divider">
        <span>yoki</span>
      </div>
      <a href="{% provider_login_url 'google' %}" class="social-btn btn-transform">
        <i class="fa-brands fa-google icon-google" style="font-size: 1.2rem"></i>
        Google bilan kirish
      </a>
      <a class="social-btn btn-transform">
        <i class="fa-brands fa-github icon-github" style="font-size: 1.2rem"></i>
        GitHub bilan kirish
      </a>
      <div class="footer-links">
        Hisobingiz mavjud emasmi? <a href="{% url 'signup' %}">Ro'yxatdan o'tish</a>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
